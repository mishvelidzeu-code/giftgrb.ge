<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>áƒ’áƒ”áƒ áƒ‘áƒ˜áƒ¡ áƒ“áƒ áƒ’áƒ•áƒáƒ áƒ˜áƒ¡ áƒ“áƒ”áƒ¢áƒáƒšáƒ”áƒ‘áƒ˜</title>
    <style>
        :root{ --bg:#f6f6f4; --white:#ffffff; --text:#1f2933; --gold:#c8a951; }
        body{ margin:0; background:var(--bg); font-family:Georgia, serif; color:var(--text); padding: 20px; }
        .status { text-align:center; margin-top:100px; font-size:18px; color: #666; }
        .container { max-width:900px; margin:40px auto; background:var(--white); border-radius:22px; padding:50px; box-shadow:0 30px 60px rgba(0,0,0,.08); display:none; }
        .cert-header { text-align:center; margin-bottom:40px; border-bottom: 2px solid #f3efe4; padding-bottom: 20px; }
        .cert-body { display:grid; grid-template-columns: 1fr 1fr; gap:40px; align-items: start; }
        .cert-body img { width:100%; border-radius:16px; border:1px solid #eee; }
        .cert-data p { margin:0 0 15px; border-bottom: 1px solid #f9f9f9; padding-bottom: 5px; }
        .cert-data span { display:block; font-size:12px; color:#999; text-transform:uppercase; }
        .cert-data strong { font-size:18px; color:#222; }
        .history-box { margin-top:40px; padding-top:20px; border-top: 1px solid #eee; }
        .history-title { color:var(--gold); font-weight:bold; margin-bottom:15px; display:block; }
        .history-text { line-height:1.8; white-space:pre-line; color:#444; }
        @media (max-width:650px) { .cert-body { grid-template-columns: 1fr; } }

.author-box{
    margin:60px auto 0;
    text-align:center;
}
.author-box img{
    width:140px;
    height:140px;
    object-fit:cover;
    border-radius:50%;
    border:3px solid var(--gold);
}
.author-box p{
    margin-top:14px;
    font-size:15px;
    color:#374151;
    line-height:1.4;
}
.author-box strong{
    display:block;
    margin-top:4px;
    font-weight:600;
    color:#1f2933;
}
.team-section{
  margin:60px auto 0;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:30px;
  text-align:center;
}

.team-member img{
  width:140px;
  height:140px;
  object-fit:cover;
  border-radius:50%;
  border:3px solid var(--gold);
  margin-bottom:12px;
}

.team-member p{
  font-size:14px;
  line-height:1.5;
  color:#374151;
}


    </style>
</head>
<body>

<div id="status" class="status">áƒ˜áƒ¢áƒ•áƒ˜áƒ áƒ—áƒ”áƒ‘áƒ áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜...</div>

<div class="container" id="mainContainer">
    <div class="cert-header">
        <h1 id="pageTitle">áƒ’áƒ”áƒ áƒ‘áƒ˜áƒ¡ áƒ¡áƒ”áƒ áƒ¢áƒ˜áƒ¤áƒ˜áƒ™áƒáƒ¢áƒ˜</h1>
    </div>

    <div class="cert-body">
        <div id="imageWrapper">
            <img id="mainImage" src="" alt="áƒ’áƒáƒ›áƒáƒ¡áƒáƒ®áƒ£áƒšáƒ”áƒ‘áƒ">
        </div>
        <div class="cert-data">
            <p><span>áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ˜áƒ¡ áƒ™áƒáƒ“áƒ˜</span> <strong id="dCode"></strong></p>
            <p><span>áƒ›áƒ¤áƒšáƒáƒ‘áƒ”áƒšáƒ˜ / áƒ’áƒ•áƒáƒ áƒ˜</span> <strong id="dOwner"></strong></p>
            <p><span>áƒ—áƒáƒ áƒ˜áƒ¦áƒ˜</span> <strong id="dDate"></strong></p>
            <p><span>áƒáƒ¦áƒ¬áƒ”áƒ áƒ</span> <strong id="dDesc"></strong></p>
        </div>
    </div>

    <div id="historySection" class="history-box" style="display:none;">
    <span class="history-title">áƒ’áƒ•áƒáƒ áƒ˜áƒ¡ áƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒ£áƒšáƒ˜ áƒ›áƒ˜áƒ›áƒáƒ®áƒ˜áƒšáƒ•áƒ</span>
    <div id="dHistory" class="history-text"></div>
</div>
<!-- ğŸ”’ áƒ¡áƒ áƒ£áƒšáƒ˜ áƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒ â€” 10â‚¾ -->
<div id="unlockSection" style="display:none; margin-top:30px; padding:20px; background:#faf8f3; border:1px dashed #c8a951; border-radius:16px; text-align:center;">
    <p style="margin:0 0 15px; font-weight:600;">
        áƒ›áƒªáƒ˜áƒ áƒ” áƒ¡áƒáƒ’áƒ•áƒáƒ áƒ”áƒ£áƒšáƒ áƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒ˜áƒ¡ áƒ¡áƒáƒœáƒáƒ®áƒáƒ•áƒáƒ“ áƒ¨áƒ”áƒ˜áƒ«áƒ˜áƒœáƒ”áƒ— áƒ”áƒšáƒ”áƒ¥áƒ¢áƒ áƒáƒœáƒ£áƒšáƒ˜ áƒáƒáƒ™áƒ”áƒ¢áƒ˜ â€” 10â‚¾
    </p>
    <button onclick="showUnlockForm()" style="padding:12px 24px; background:#c8a951; border:none; border-radius:10px; font-weight:600; cursor:pointer;">
        áƒ›áƒªáƒ˜áƒ áƒ” áƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒ â€” 10â‚¾
    </button>
</div>

<!-- ğŸ“ áƒ¨áƒ”áƒ™áƒ•áƒ”áƒ—áƒ˜áƒ¡ áƒ¤áƒáƒ áƒ›áƒ -->
<div id="unlockForm" style="display:none; margin-top:20px; background:#fff; padding:20px; border-radius:16px; border:1px solid #eee;">
    <input type="text" id="uName" placeholder="áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜ áƒ“áƒ áƒ’áƒ•áƒáƒ áƒ˜" style="width:100%; padding:12px; margin-bottom:10px; border-radius:8px; border:1px solid #ddd;">
    <input type="tel" id="uPhone" placeholder="áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜áƒ¡ áƒœáƒáƒ›áƒ”áƒ áƒ˜" style="width:100%; padding:12px; margin-bottom:10px; border-radius:8px; border:1px solid #ddd;">
    <input type="text" id="uSurname" readonly style="width:100%; padding:12px; margin-bottom:10px; border-radius:8px; border:1px solid #ddd;">
    
    <button onclick="sendUnlockRequest()" style="width:100%; padding:12px; background:#c8a951; border:none; border-radius:10px; font-weight:600; cursor:pointer;">
        áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ
    </button>
    <div id="unlockMsg" style="margin-top:10px; font-weight:600;"></div>
</div>


<!-- áƒáƒ•áƒ¢áƒáƒ áƒ˜ áƒáƒ¥, historySection-áƒ˜áƒ¡ áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’ -->
<div class="team-section">

<div class="team-member">

  <a href="https://ka.wikipedia.org/wiki/%E1%83%9A%E1%83%94%E1%83%95%E1%83%90%E1%83%9C_%E1%83%91%E1%83%94%E1%83%A0%E1%83%90%E1%83%98%E1%83%90" target="_blank">
    <img src="images/levani.webp" alt="áƒšáƒ”áƒ•áƒáƒœ áƒ‘áƒ”áƒ áƒáƒ˜áƒ">
  </a>

  <p>
    <strong>áƒ’áƒ•áƒáƒ áƒ˜áƒ¡ áƒ›áƒ™áƒ•áƒšáƒ”áƒ•áƒáƒ áƒ˜ áƒáƒ áƒáƒ¤áƒ”áƒ¡áƒáƒ áƒ˜</strong><br>
    áƒšáƒ”áƒ•áƒáƒœ áƒ‘áƒ”áƒ áƒáƒ˜áƒ<br>
    <a href="https://ka.wikipedia.org/wiki/%E1%83%9A%E1%83%94%E1%83%95%E1%83%90%E1%83%9C_%E1%83%91%E1%83%94%E1%83%A0%E1%83%90%E1%83%98%E1%83%90" 
       target="_blank" 
       style="color:#c8a951; font-weight:600; text-decoration:none;">
       Wikipedia
    </a>
  </p>

</div>

  <div class="team-member">
    <img src="images/valeri.webp" alt="áƒ•áƒáƒšáƒ”áƒ áƒ˜">
    <p>
      <strong>áƒ’áƒ•áƒáƒ áƒ˜áƒ¡ áƒ›áƒ™áƒ•áƒšáƒ”áƒ•áƒáƒ áƒ˜ áƒáƒ áƒáƒ¤áƒ”áƒ¡áƒáƒ áƒ˜</strong><br>
      áƒ•áƒáƒšáƒ”áƒ áƒ˜ áƒ®áƒ˜áƒ›áƒ¨áƒ˜áƒáƒ¨áƒ•áƒ˜áƒšáƒ˜
    </p>
  </div>

  <div class="team-member">
    <img src="images/ucha.webp" alt="áƒ£áƒ©áƒ">
    <p>
      <strong>áƒáƒ áƒáƒ”áƒ¥áƒ¢áƒ–áƒ” áƒ›áƒ£áƒ¨áƒáƒáƒ‘áƒ¡</strong><br>
      áƒ£áƒ©áƒ áƒ›áƒ˜áƒ¨áƒ•áƒ”áƒšáƒ˜áƒ«áƒ”
    </p>
  </div>

  

</div>

<script>
async function loadRegistry() {
    const params = new URLSearchParams(window.location.search);
    const code = params.get('code')?.toUpperCase();

    if (!code) {
        document.getElementById('status').innerText = "áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: áƒ™áƒáƒ“áƒ˜ áƒáƒ  áƒáƒ áƒ˜áƒ¡ áƒ›áƒ˜áƒ—áƒ˜áƒ—áƒ”áƒ‘áƒ£áƒšáƒ˜.";
        return;
    }

    try {
        const [regRes, surRes] = await Promise.all([
            fetch('registry.json'),
            fetch('surnames.json')
        ]);

        if (!regRes.ok) throw new Error("registry.json áƒ•áƒ”áƒ  áƒ©áƒáƒ˜áƒ¢áƒ•áƒ˜áƒ áƒ—áƒ");

        const registry = await regRes.json();
        const surnames = surRes.ok ? await surRes.json() : [];

        const crest = registry.find(item => item.code.toUpperCase() === code);
        const historyData = surnames.find(item => item.crestCode?.toUpperCase() === code);

        if (!crest && !historyData) {
            document.getElementById('status').innerText =
                "áƒ©áƒáƒœáƒáƒ¬áƒ”áƒ áƒ˜ áƒ™áƒáƒ“áƒ˜áƒ— " + code + " áƒ•áƒ”áƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ.";
            return;
        }

        document.getElementById('status').style.display = 'none';
        document.getElementById('mainContainer').style.display = 'block';

        if (crest) {
            document.getElementById('dCode').innerText = crest.code;
            document.getElementById('dOwner').innerText = crest.owner;
            document.getElementById('dDate').innerText = crest.date;
            document.getElementById('dDesc').innerText = crest.description;

            if (crest.image) {
                document.getElementById('mainImage').src = crest.image;
            } else {
                document.getElementById('imageWrapper').style.display = 'none';
            }
        }

        if (historyData && historyData.history) {
            document.getElementById('historySection').style.display = 'block';

            const fullHistory = historyData.history;
            const firstSentenceMatch = fullHistory.match(/.*?[.!?]/);
            const firstSentence = firstSentenceMatch
                ? firstSentenceMatch[0]
                : fullHistory;

            document.getElementById('dHistory').innerText = firstSentence;
            document.getElementById('unlockSection').style.display = 'block';
            document.getElementById('uSurname').value = historyData.surname;

            if (!crest) {
                document.getElementById('dOwner').innerText = historyData.surname;
                document.getElementById('dCode').innerText = historyData.crestCode;
                document.getElementById('pageTitle').innerText =
                    "áƒ¡áƒáƒ’áƒ•áƒáƒ áƒ”áƒ£áƒšáƒ áƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒ";
                if (historyData.image)
                    document.getElementById('mainImage').src = historyData.image;
            }
        }
    } catch (err) {
        console.error(err);
        document.getElementById('status').innerText =
            "áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ—áƒ áƒ‘áƒáƒ–áƒáƒ¡áƒ—áƒáƒœ áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ˜ áƒ•áƒ”áƒ  áƒ“áƒáƒ›áƒ§áƒáƒ áƒ“áƒ.";
    }
}

window.onload = loadRegistry;

function showUnlockForm() {
    const form = document.getElementById('unlockForm');
    form.style.display = 'block';
    form.scrollIntoView({ behavior: "smooth" });
}

function sendUnlockRequest() {
    const name = document.getElementById('uName').value.trim();
    const phone = document.getElementById('uPhone').value.trim();
    const surname = document.getElementById('uSurname').value.trim();
    const msgBox = document.getElementById('unlockMsg');

    if (!name || !phone) {
        msgBox.style.color = "#b91c1c";
        msgBox.innerText = "áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒ¨áƒ”áƒáƒ•áƒ¡áƒáƒ— áƒ§áƒ•áƒ”áƒšáƒ áƒ•áƒ”áƒšáƒ˜";
        return;
    }

    const orderId = "SUR-" + Math.floor(1000 + Math.random() * 9000);

    fetch("https://script.google.com/macros/s/AKfycby251xJAamWczfxkAr9yK-n2wXNb-cbq6MmrjFztqrqsBps_1HM44L_G4qZG37sHKoiSQ/exec", {
        method: "POST",
        mode: "no-cors",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded"
        },
        body: new URLSearchParams({
            buyerName: name,
            phone: phone,
            target: surname,
            box: "10â‚¾ áƒ›áƒªáƒ˜áƒ áƒ” áƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒ",
            products: "áƒ›áƒªáƒ˜áƒ áƒ” áƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒ",
            total: "10",
            orderId: orderId,
            source: "Surname Page"
        })
    });

    msgBox.style.color = "#16a34a";
    msgBox.innerText = "áƒ›áƒáƒ—áƒ®áƒáƒ•áƒœáƒ áƒ’áƒáƒ˜áƒ’áƒ–áƒáƒ•áƒœáƒ âœ”";

    document.getElementById('uName').value = "";
    document.getElementById('uPhone').value = "";
}
</script>



</body>
</html>